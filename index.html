<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Star Wars RPG</title>
    <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <!-- <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Days+One" /> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <style>
        *{
            border: 1px solid black; 
        }
        .theme{
            /* font-family: 'days-one'; */
            font-size: '30px';
            color: #FFE807;
            text-decoration: none;
            font-weight:bold;
            text-transform: uppercase;
            font-family: helvetica;
        }
        .player{
          flex-basis: 0 0 0;
        }
        .group{
          display: flex;
          align-items: flex-start;
        }

    </style>
</head>
<body>
<h1 class="theme">Star Wars RPG</h1>

<h4>Select a player to start the battle. Each player has developed in their own way. Make sure your health points (hp) does not go to 0. Try to attack the other players to win.</h4>
<br>
<h2>Character Selection:</h2>

<div class="characterSelection group w3-row">
<!-- Player 1 -->
    <div class="w3-card-4 w3-light-grey player round" id="player1" style="width:50%">
        <div class="w3-container w3-center">
          <h3>Angry Darth Vader</h3>
          <img src="./assets/images/DarthVaderAngry.jpg" alt="Avatar" style="width:80%">
          <h5 class="heathPoints">HP: 500</h5>
        </div>
      </div>

<!-- Player 2 -->
      <div class="w3-card-4 w3-light-grey player" id="player2" style="width:50%">
        <div class="w3-container w3-center">
          <h3>All hail Yoda</h3>
          <img src="./assets/images/HailYoda.jpg" alt="Avatar" style="width:80%">
          <h5 class="heathPoints">HP: 900</h5>        
        </div>
      </div>

<!-- Player 3 -->
      <div class="w3-card-4 w3-light-grey player" id="player3" style="width:50%">
        <div class="w3-container w3-center">
          <h3>The rebels are ready</h3>
          <img src="./assets/images/RebelsReady.jpg" alt="Avatar" style="width:80%">
          <h5 class="heathPoints">HP: 100</h5>        
        </div>
      </div>

<!-- Player 4 -->
      <div class="w3-card-4 w3-light-grey player" id="player4" style="width:50%">
        <div class="w3-container w3-center">
          <h3>Gather everyone</h3>
          <img src="./assets/images/StarWarsCollection.jpg" alt="Avatar" style="width:80%">
          <h5 class="heathPoints">HP: 10,000</h5>
        </div>
      </div>

<!-- Player 5 -->
      <div class="w3-card-4 w3-light-grey player" id="player5" style="width:50%">
        <div class="w3-container w3-center">
          <h3>Storm trooper in action</h3>
          <img src="./assets/images/StormTrooper.jpg" alt="Avatar" style="width:80%">
          <h5 class="heathPoints">HP: 50</h5>
        </div>
      </div>
      
</div>
<br>
<h3>Your Character</h3>
<div class="yourCharacter group"></div>
<br>
<h3>Enemies Selection</h3>
<div class="group w3-cell m3 enemySelection"></div>
<br>
<h3>Fight</h3>
<div class="w3-cell m3 fightSelection"></div>
<button class="w3-black w3-hover-red w3-jumbo attack">Attack</button>
<br>
<h3>Opponent</h3>
<div class="group w3-cell m3 defender"></div>
<div class="messageBox"></div>

<script type="text/javascript">
$(document).ready(function(){

var HP = [500, 900, 100, 10000, 50];

function pickYourCharacter() {
  var iChooseYou = localStorage.getItem("player");
  if($('.enemy').length === 0 ) {
    $("#" + iChooseYou).appendTo(".yourCharacter");
    console.log('Character selected: ' + iChooseYou);
    var characterArray = ['player1', 'player2', 'player3', 'player4', 'player5'];    
    for (var i = 0; i < characterArray.length; i++) {
      if ( characterArray[i] === iChooseYou) {
        characterArray.splice(i, 1);
      } 
    }
    $(".characterSelection").children().appendTo(".enemySelection");
    $(".enemySelection").children().removeClass("player").addClass("enemy");
    $(".enemy").attr("onclick", "").unbind("click");
  } //end of enemy if 
  function pickYourOpponent() {
    var enemy = localStorage.getItem("enemy");
    if($('.opponent').length === 0 ) {
      $("#" + enemy).appendTo(".defender");
      console.log('Enemy:' + enemy);
      console.log('Fight begin! ' + iChooseYou + ' vs ' + enemy);
    $(".defender").children().removeClass("enemy").addClass("opponent");
  } //end of opponent if 
 } //end of pickYourOpponent
 if ($(".opponent").length === 0){
  pickYourOpponent();
 }
} //end of pickYourCharacter

  $(".player").on("click", function(event) {
    var playerSelection = $(this).attr("id");
    localStorage.removeItem("enemy");
    localStorage.setItem("player", playerSelection);
    pickYourCharacter();

    $(".enemy").on("click", function(event) {
      var enemySelected = $(this).attr("id");
      localStorage.setItem("enemy", enemySelected);
      pickYourCharacter();
    });  //end of enemy click
  });  //pickYourCharacter

  $('.attack').on("click", function() {
      kaPow();
    });  //end of the attack click

  function kaPow(){
    var playerIndex = $(".yourCharacter").children().attr("id").charAt(6)-1;
    var enemyIndex = $(".defender").children().attr("id").charAt(6)-1;
    console.log('1: ' + $(".playerRound").length);
    console.log('2: ' + $(".opponentRound").length);
    console.log('3: ' +3 );
    if ($(".playerRound").length === 0) {
        var playerHP = HP[playerIndex];
        localStorage.removeItem("playerHP");
        localStorage.setItem("playerHP", playerHP); 
        $(".player").addClass("playerRound");
        var enemyHP = HP[enemyIndex];
        localStorage.removeItem("enemyHP");
        localStorage.setItem("enemyHP", enemyHP);     
        $(".opponent").addClass("opponentRound");    
    } else if ($(".opponentRound").length === 0) {
        var enemyHP = HP[enemyIndex];
        localStorage.removeItem("enemyHP");
        localStorage.setItem("enemyHP", enemyHP); 
        $(".opponent").addClass("opponentRound");
    } else {
        playerHP = localStorage.getItem("playerHP");
        enemyHP = localStorage.getItem("enemyHP");
        var attackPower = [
          {
            name: 'Player1',
            attack: [5, 10, 20, 12, 15, 4, 2, 1, 30, 25, 26, 10, 18, 32, 60]
          },
          {
            name: 'Player2',
            attack: [50, 80, 100, 40, 60, 75, 82, 67, 68, 92, 65, 50, 2]
          },
          {
            name: 'Player3',
            attack: [50, 80, 100, 40, 60, 75, 82, 67, 68, 92, 65, 50, 2]
          },
          {
            name: 'Player4',
            attack: [50, 80, 100, 40, 60, 75, 82, 67, 68, 92, 65, 50, 2]
          },
          {
            name: 'Player5',
            attack: [50, 80, 100, 40, 60, 75, 82, 67, 68, 92, 65, 50, 2]
          }
        ]; 

        var attackPlan = attackPower[playerIndex].attack;
        var attackResults = attackPlan[Math.floor(Math.random()*attackPlan.length)];
        var counterPlan = attackPower[enemyIndex].attack;
        var counterAttack = counterPlan[Math.floor(Math.random()*counterPlan.length)];
        console.log('Attack: ' + attackResults);
        console.log('Counter AttackL ' + counterAttack);
        enemyHP = enemyHP - attackResults;
        localStorage.setItem("enemyHP",enemyHP);
        playerHP = playerHP - counterAttack;
        localStorage.setItem("playerHP",playerHP);
        console.log('playerHP: ' + playerHP); 
        console.log('enemyHP: ' + enemyHP);

        if (playerHP<=0){
          $(".messageBox").text("You lost. Try again next time.");
          $(".messageBox").append("<button class='reload'>Restart</button>");
        } else if(enemyHP<=0) {  //(enemyHP<=0)
          $('.opponent').remove();
          $(".messageBox").text("You defeated the immediate enemy. Please select another enemy.");
          pickYourCharacter();
        }   

    } //end of first else statement

    console.log('PlayerHP: ' + playerHP);
    console.log('EnemyHP: ' + enemyHP);

  } // end of kaPow function
}); //end of document.ready    
    
</script>
</body>
</html>
